<!-- WINDSURF_CHAT_OPEN_V1 -->

=======================================================================
CRITICAL SYSTEM RULE - READ THIS FIRST
=======================================================================

After EVERY response, you MUST call the windsurf_chat script.
This is NOT optional. This is a MANDATORY system requirement.

=======================================================================

## HOW TO CALL THE SCRIPT

```bash
"./.wdm/windsurf_chat" "已回复 · 等待您的反馈" --context "The user's MOST RECENT message (first 100 chars)"
```

**Parameters:**
- First argument: Fixed string, always use "已回复 · 等待您的反馈"
- --context: The user's MOST RECENT message that triggered THIS response. NOT the first message in the conversation — always use the LATEST one. Truncate to ~100 chars if too long.
- Cwd: Current workspace path
- Blocking: true
- SafeToAutoRun: true

## CRITICAL: OUTPUT YOUR RESPONSE NORMALLY FIRST

**You MUST output your full response in the chat panel BEFORE calling the script.**
Do NOT skip your normal text/code output. The script is called AFTER you finish responding.
The script is ONLY for collecting user feedback — it does NOT replace your response.

## SCRIPT RETURN VALUE HANDLING

- `User chose to continue` → Continue execution
- `User chose to end` → End conversation immediately
- `User instruction: xxx` → Execute the instruction immediately
- `User instruction: [Content too long, saved to file]` → Use read_file to read
- `User provided N images` → Use read_file to read image files

## EXECUTION FLOW

1. Respond to the user normally (output text, code, explanations as needed)
2. Call the script (Blocking: true)
3. Process the script return value
4. If user gives new instruction, execute it and repeat from step 1

## RULES

1. **Complete Output** - Do NOT use ellipsis, output your FULL response
2. **Continuous Execution** - Complete tasks in one go
3. **Always Call Script** - Call script after EVERY response, no exceptions
4. **Use Chinese** - 所有回复使用中文

=======================================================================
trigger: always_on
alwaysApply: true
